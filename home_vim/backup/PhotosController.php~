<?php

   class PhotosController extends AppController {
	  var $uses = array('Photo');
	  var $components = array('RequestHandler');
	  var $scaffold;

	  function beforeFilter() {
		 parent::beforeFilter();
		 /* If it is ajax request don't load template. */
		 if($this->RequestHandler->isAjax()){
			$this->layout=null;
		 }
	  }

	  /** 
	  * add a photo to the database.
	  * id: photo facebook id.
	  */
	  function add($id = null) {
		 $this->autoRender = false;
		 /* if there is a photo to insert and user is logged in.*/
		 if($id != null && $this->user) {
			$data = $this->facebook->api("/$id");
			$newPhoto = $this->Photo->create();
			$newPhoto['id'] = $data['id'];
			$newPhoto['name'] = $data['from']['name'];
			$newPhoto['picture'] = $data['picture'];
			$newPhoto['source'] = $data['source'];
			$newPhoto['width'] = $data['width'];
			$newPhoto['height'] = $data['height'];
			$newPhoto['link'] = $data['link'];
			$newPhoto['fbuser_id'] = $this->user;
			$this->Photo->save($newPhoto);
		 }
	  }


	  function view($id = null) {
		 if($id != null) {
			$photo = $this->Photo->findById($id);
		 }
	  }


	  /**
	  * get a photo url from post, parse fbid and call add method.
	  */
	  function insert() {
		 // TODO
	  }

   }

?>
